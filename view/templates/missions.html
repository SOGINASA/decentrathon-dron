<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Миссии — DroneControl</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body class="missions-page">
  <header>
    <nav>
      <div class="logo">DroneControl</div>
      <ul class="nav-links">
        <li>
          <a href="{{ url_for('index') }}"
             class="{% if request.endpoint=='index' %}active{% endif %}">
            Мониторинг
          </a>
        </li>
        <li>
          <a href="{{ url_for('missions') }}"
             class="{% if request.endpoint=='missions' %}active{% endif %}">
            Миссии
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin.logs') }}"
             class="{% if request.endpoint=='logs' %}active{% endif %}">
            Логи
          </a>
        </li>
        <li>
          <a href="{{ url_for('admin.drones') }}"
             class="{% if request.endpoint=='drones' %}active{% endif %}">
            Дроны
          </a>
        </li>
        <li>
          <a href="{{ url_for('pilots') }}"
             class="{% if request.endpoint=='pilots' %}active{% endif %}">
            Пилоты
          </a>
        </li>
        {% if current_user.is_authenticated %}
          <li><a href="{{ url_for('auth.logout') }}">Выход</a></li>
        {% else %}
          <li><a href="{{ url_for('auth.login') }}">Вход</a></li>
          <li><a href="{{ url_for('auth.register') }}">Регистрация</a></li>
        {% endif %}
      </ul>
    </nav>
  </header>

  <main>
    <section class="missions-list">
      <h2>Список миссий</h2>

      <!-- Пример заявки -->
      {% for mission in missions %}
      <div class="mission-card">
        <div class="mission-header">
          <h3>Заявка #{{ mission.id }}</h3>
          <span class="status-badge 
               {% if mission.status=='pending' %}status-pending{% endif %}
               {% if mission.status=='approved' %}status-approved{% endif %}
               {% if mission.status=='rejected' %}status-rejected{% endif %}">
            {{ mission.status_display }}
          </span>
        </div>
        <p><strong>Координаты:</strong>
          <a href="#" class="coords"
             data-lat="{{ mission.lat }}"
             data-lng="{{ mission.lng }}">
            {{ mission.lat }}, {{ mission.lng }}
          </a>
        </p>
        {% if mission.address %}
        <p><strong>Адрес:</strong> {{ mission.address }}</p>
        {% endif %}
        <p><strong>Время доставки:</strong> {{ mission.time.strftime('%d.%m.%Y, %H:%M') }}</p>
      </div>
      {% else %}
      <p>Миссии не найдены.</p>
      {% endfor %}
    </section>

    <!-- Модалка с картой -->
    <div id="mapModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modalMap"></div>
      </div>
    </div>
  </main>

  <footer>&copy; 2025 Drone Hackathon by <span style="color: #e63946;"><b>ITshechka</b></span></footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="{{ url_for('static', filename='missions.js') }}"></script>
</body>
</html>
